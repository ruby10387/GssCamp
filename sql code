SELECT blr.KEEPER_ID AS [KeeperId],mm.USER_CNAME AS [CName],mm.USER_ENAME AS [EName],YEAR(blr.LEND_DATE) AS [BorrowYear],COUNT(*) AS [BorrowCnt]
FROM BOOK_LEND_RECORD blr INNER JOIN MEMBER_M mm 
ON blr.KEEPER_ID=mm.USER_ID 
GROUP BY blr.KEEPER_ID,mm.USER_CNAME,mm.USER_ENAME,YEAR(blr.LEND_DATE)
ORDER BY KeeperId,BorrowYear;

SELECT TOP 5 blr.BOOK_ID AS [BookId],bd.BOOK_NAME AS [BookName],COUNT(*) AS [QTY]
FROM BOOK_LEND_RECORD blr JOIN BOOK_DATA bd
ON blr.BOOK_ID=bd.BOOK_ID
GROUP BY blr.BOOK_ID,bd.BOOK_NAME
ORDER BY QTY DESC;

SELECT CASE (MONTH(blr.LEND_DATE)-1)/3 
WHEN 0 THEN '2019/01~2019/03'
WHEN 1 THEN '2019/04~2019/06' 
WHEN 2 THEN '2019/07~2019/09'
WHEN 3 THEN '2019/10~2019/12'END AS [Quarter],
COUNT(*) AS [Cnt] 
FROM BOOK_LEND_RECORD blr
WHERE YEAR(blr.LEND_DATE)=2019
GROUP BY (MONTH(blr.LEND_DATE)-1)/3;

SELECT * FROM BOOK_LEND_RECORD blr;
SELECT * FROM BOOK_CLASS bc;
SELECT * FROM BOOK_DATA bd;

SELECT bc.BOOK_CLASS_NAME AS [BookClass],bd.BOOK_ID AS [BoolId],bd.BOOK_NAME AS [BookName],COUNT(*) 
FROM BOOK_DATA bd JOIN BOOK_CLASS bc 
ON bd.BOOK_CLASS_ID=bc.BOOK_CLASS_ID 
JOIN BOOK_LEND_RECORD blr
ON bd.BOOK_ID=blr.BOOK_ID;
